Activation=function(){var c=null,b=null,a=0;return{init:function(){c=Kebab.helper.url("kebab/user-activation");this.buildActivationForm();Ext.fly("login-link").on("click",function(d){d.stopEvent();Kebab.helper.redirect("backend")},this)},buildActivationForm:function(){b=new Ext.FormPanel({renderTo:"activation-form",bodyCssClass:"kebab-transparent",url:c,frame:false,labelAlign:"top",width:"100%",buttonAlign:"left",waitMsgTarget:true,border:false,defaultType:"textfield",hideLabels:true,items:[{name:"activationKey",hidden:true},{fieldLabel:Kebab.helper.translate("Your full name"),emptyText:Kebab.helper.translate("Your full name"),name:"fullName",allowBlank:false,anchor:"100%"},{fieldLabel:Kebab.helper.translate("Your e-mail address"),emptyText:Kebab.helper.translate("Your e-mail address"),name:"email",allowBlank:false,readOnly:true,vtype:"email",anchor:"100%"},{xtype:"fieldset",title:Kebab.helper.translate("Your user name & password"),collapsible:false,autoHeight:true,hideLabels:true,defaults:{xtype:"textfield",allowBlank:false,anchor:"100%"},items:[{fieldLabel:Kebab.helper.translate("User name"),emptyText:Kebab.helper.translate("User name"),name:"userName"},{xtype:"compositefield",hideLabels:true,defaults:{xtype:"textfield",flex:1,inputType:"password"},items:[{fieldLabel:Kebab.helper.translate("Password"),emptyText:Kebab.helper.translate("Password"),name:"password",id:"activation-password"},{fieldLabel:Kebab.helper.translate("Confirm password"),emptyText:Kebab.helper.translate("Confirm password"),name:"confirmPassword",vtype:"password",initialPassField:"activation-password"}]}]}],buttons:[{width:80,iconCls:"icon-accept",text:Kebab.helper.translate("Send"),handler:function(){this.activationAction()},scope:this},{xtype:"panel",border:false,bodyCssClass:"kebab-transparent",html:'<a href="#" id="login-link">'+Kebab.helper.translate("Login")+"</a>"}],keys:[{key:[Ext.EventObject.ENTER],handler:function(){this.activationAction()},scope:this}],listeners:{beforeRender:function(){this.setActivationKey()},afterRender:function(d){if(this.getActivationKey()==0){this.disableFormItems(d,d.items)}Ext.apply(Ext.form.VTypes,{password:function(g,f){if(f.initialPassField){var e=Ext.getCmp(f.initialPassField);return(g==e.getValue())}return true},passwordText:Kebab.helper.translate("Passwords do not match!")});this.checkActivationKeyAction(d)},scope:this}})},disableFormItems:function(e,d){d.each(function(f){if(f.items){this.disableFormItems(e,f.items)}else{f.markInvalid();f.disable()}},this);e.buttons[0].setIconClass("icon-cancel");e.buttons[0].setText(Kebab.helper.translate("Invalid activation key !&nbsp;"));e.buttons[0].disable()},getActivationKey:function(){return a},setActivationKey:function(d){a=Ext.get("activation-key").getValue()},showPreLoader:function(){Ext.fly("kebab-progress-bar").fadeIn();Ext.fly("activation-form-wrapper").fadeOut();Ext.fly("kebab-system-backend-activation-container").scale(270,[65])},showActivationForm:function(){Ext.fly("kebab-progress-bar").fadeOut();Ext.fly("activation-form-wrapper").fadeIn();Ext.fly("kebab-system-backend-activation-container").scale([300],[385])},checkActivationKeyAction:function(d){this.showPreLoader();d.getForm().load({method:"GET",url:c+"/key/"+this.getActivationKey(),success:function(){console.log(arguments);this.showActivationForm()},failure:function(){this.showActivationForm();this.disableFormItems(d,d.items)},scope:this})},activationAction:function(){if(b.getForm().isValid()){this.showPreLoader();b.getForm().submit({method:"POST",success:function(){Kebab.helper.redirect("backend/desktop")},failure:function(){this.showActivationForm()},scope:this})}}}}();Ext.onReady(Activation.init,Activation);