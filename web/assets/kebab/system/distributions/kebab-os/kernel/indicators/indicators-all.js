Ext.namespace("Kebab.OS.Indicators.Connection");Kebab.OS.Indicators.Connection=Ext.extend(Kebab.OS.Indicator,{id:"kebab-os-panel-indicators-connection",initComponent:function(){var a={iconCls:"icon-server-connect",handler:function(){this.showWindowAction()},scope:this};this.buildConnetionDetails();Ext.apply(this,a);Kebab.OS.Indicators.Connection.superclass.initComponent.call(this)},buildConnetionDetails:function(){this.connectionDetails=new Ext.grid.GridPanel({frame:true,store:new Ext.data.JsonStore({autoDestroy:true,fields:["url","method","status","statusText","response","success","time"]}),colModel:new Ext.grid.ColumnModel({columns:[{header:"Url",width:300,sortable:true,dataIndex:"url"},{header:"Method",sortable:true,dataIndex:"method"},{header:"Status",sortable:true,dataIndex:"status",renderer:function(b,a,c){return b+" - "+c.data.statusText}},{header:"Success",sortable:true,dataIndex:"success",renderer:function(b){var a=b?"green":"red";return"<span style='color:"+a+"'>"+b+"</span>"}},{header:"Time",align:"right",sortable:true,dataIndex:"time",renderer:function(a){return a+" sec"}}]}),viewConfig:{forceFit:true}})},listeners:{afterRender:function(){Ext.Ajax.on("beforerequest",this.beforeRequestAction,this);Ext.Ajax.on("requestcomplete",this.requestCompleteAction,this);Ext.Ajax.on("requestexception",this.requestExceptionAction,this)}},beforeRequestAction:function(){this.reqStart=new Date();this.setIconClass("icon-loading")},requestCompleteAction:function(b,a,c){this.reqStop=new Date();var d=(this.reqStop.getTime()-this.reqStart.getTime())/1000;this.setTooltip("Time: "+d+" seconds");this.setIconClass("icon-server-connect");var f=Ext.util.JSON.decode(a.responseText);try{if(f.notifications.length>0){Ext.each(f.notifications,function(e){Kebab.helper.message("Server Message",e.message,e.keep,e.type)})}}catch(g){}this.logAction({url:c.url,method:c.method,status:a.status,statusText:a.statusText,response:f,success:f.success,time:d})},requestExceptionAction:function(c,b,d){this.setIconClass("icon-server-disconnect");if(b.status==401){var a=Ext.getCmp("kebab-os-panel-indicators-session");if(a){a.showLockScreenAction()}}else{Kebab.helper.dialog("Connection Error","There was a connection problem. Please try again.","ERR")}},logAction:function(c){var b=this.connectionDetails.getStore();var a=new b.recordType(c);b.insert(0,a)},showWindowAction:function(){if(!this.window){this.window=new Kebab.OS.Indicator.Window({title:Kebab.helper.translate("Kebab Connection"),indicator:this,width:600,border:false,height:300,iconCls:"icon-connect",items:this.connectionDetails});this.window.show()}else{this.window.hidden?this.window.show():this.window.hide()}}});Ext.namespace("Kebab.OS.Indicators.Language");Kebab.OS.Indicators.Language=Ext.extend(Kebab.OS.Indicator,{initComponent:function(){var a={text:Kebab.helper.translate(Kebab.getOS().getTranslator().getLanguages(true).text),iconCls:Kebab.getOS().getTranslator().getLanguages(true).iconCls};Ext.apply(this,a);Kebab.OS.Indicators.Language.superclass.initComponent.call(this)}});Ext.namespace("Kebab.OS.Indicators.QuickStart");Kebab.OS.Indicators.QuickStart=Ext.extend(Kebab.OS.Indicator,{initComponent:function(){var a=new Ext.form.ComboBox({emptyText:Kebab.helper.translate("Quick start..."),tpl:'<tpl for="."><div ext:qtip="{description}" class="x-combo-list-item">{title}</div></tpl>',storeLoaded:false,typeAhead:true,width:150,triggerAction:"all",forceSelection:true,hideTrigger:true,lazyRender:false,mode:"local",store:new Ext.data.JsonStore({fields:["id","name","department",{name:"title",type:"object",mapping:"title.text"},{name:"description",type:"object",mapping:"title.description"}]}),valueField:"id",displayField:"title",hiddenName:"id",listeners:{focus:function(b){if(!b.storeLoaded){b.store.loadData(this.kernel.getApplications());b.storeLoaded=true}},select:function(c,b){this.kernel.getDesktop().launchApplication(b.id);c.reset()},scope:this}});Ext.apply(this,a);Kebab.OS.Indicators.QuickStart.superclass.initComponent.call(this)}});Ext.namespace("Kebab.OS.Indicators.Session");Kebab.OS.Indicators.Session=Ext.extend(Kebab.OS.Indicator,{id:"kebab-os-panel-indicators-session",initComponent:function(){var a={iconCls:"icon-shutdown",menu:[{text:Kebab.helper.translate("Lock Screen"),iconCls:"icon-lock",handler:function(){this.showLockScreenAction()},scope:this},"-",{text:Kebab.helper.translate("Logout..."),iconCls:"icon-door-out",handler:function(){Kebab.getOS().logoutAction(this.user.id,true)},scope:this},{text:Kebab.helper.translate("Restart..."),iconCls:"icon-arrow-refresh",handler:function(){Kebab.getOS().rebootAction()}}]};Ext.apply(this,a);Kebab.OS.Indicators.Session.superclass.initComponent.call(this)},showLockScreenAction:function(){if(!this.window){this.unlockForm=new Ext.FormPanel({title:Kebab.helper.translate("Unlock Screen"),iconCls:"icon-lock-open",url:Kebab.helper.url("kebab/session"),frame:true,bodyStyle:"text-align:center;",labelAlign:"top",width:"100%",buttonAlign:"left",border:false,defaultType:"textfield",hideLabels:true,items:[{hidden:true,name:"userName",value:this.user.userName},{xtype:"panel",bodyStyle:"font-size:18px;",html:this.user.fullName},{fielLabel:Kebab.helper.translate("Your password"),emptyText:Kebab.helper.translate("Your password"),name:"password",anchor:"80%",inputType:"password",allowBlank:false}],keys:[{key:[Ext.EventObject.ENTER],handler:function(){this.unlockAction()},scope:this}]});this.window=new Ext.Window({indicator:this,width:250,border:false,modal:true,draggable:false,closable:false,collapsible:false,autoHeight:true,resizable:false,buttonAlign:"center",items:this.unlockForm,buttons:[{width:80,iconCls:"icon-door-out",text:Kebab.helper.translate("Logout..."),handler:function(){Kebab.getOS().logoutAction(this.user.id,true)},scope:this},{width:80,iconCls:"icon-accept",text:Kebab.helper.translate("Unlock"),handler:function(){this.unlockAction()},scope:this}]});this.window.show()}else{this.window.show()}},unlockAction:function(){var a=this.unlockForm.getForm();if(a.isValid()){a.submit({waitMsg:Kebab.helper.translate("Unlocking your screen..."),success:function(){this.window.hide();a.reset()},failure:function(){a.findField("password").reset();a.findField("password").markInvalid()},scope:this})}}});Ext.namespace("Kebab.OS.Indicators.SystemTime");Kebab.OS.Indicators.SystemTime=Ext.extend(Kebab.OS.Indicator,{initComponent:function(){var a={text:new Date().format("d-m-Y, G:i"),iconCls:"icon-clock",menu:new Ext.menu.DateMenu()};Ext.apply(this,a);Kebab.OS.Indicators.SystemTime.superclass.initComponent.call(this)},listeners:{afterRender:function(a){var b={run:function(){a.setText(new Date().format("d-m-Y, G:i"))},interval:60000};Ext.TaskMgr.start(b)}}});Ext.namespace("Kebab.OS.Indicators.User");Kebab.OS.Indicators.User=Ext.extend(Kebab.OS.Indicator,{user:null,initComponent:function(){var a={iconCls:"icon-status-online",template:this.buttonTpl,text:this.user.fullName,handler:function(){this.kernel.getDesktop().launchApplication("aboutMe-application")},scope:this};Ext.apply(this,a);Kebab.OS.Indicators.User.superclass.initComponent.call(this)}});