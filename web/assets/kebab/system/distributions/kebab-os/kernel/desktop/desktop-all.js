Ext.namespace("Kebab.OS.Kernel");Kebab.OS.Kernel=function(a){this.isBooted=false;this.serviceAPI="api";this.distribution="KebabOS";this.assets=null;this.settings=null;this.user=null;this.apps=null;this.stories=null;this.applications=null;this.stateProvider=new Ext.state.CookieProvider();Ext.apply(this,a);this.addEvents({booted:true,beforeunload:true});Ext.onReady(this.boot,this)};Ext.extend(Kebab.OS.Kernel,Ext.util.Observable,{init:function(){Ext.state.Manager.setProvider(this.stateProvider);Kebab.helper.log("Kebab.OS.Kernel initialized...")},boot:function(){this.init();this.desktop=new Kebab.OS.Desktop(this);this.windowList=this.desktop.windowList;this.applications=this.applications||this.loadApplications();if(this.applications){this.initApplications()}Ext.EventManager.on(window,"beforeunload",this.onUnload,this);this.fireEvent("booted",this);this.isBooted=true;if(this.isBooted){Kebab.helper.log("Kebab.OS.Kernel booted...");Kebab.helper.message("Kebab Project","Welcome to Kebab Project. Have fun!")}},loadApplications:function(){var i=0,applicationInstances=new Array();Ext.each(this.apps,function(application){try{applicationInstances[i++]=Ext.applyIf(eval("new "+application.className+"()"),application)}catch(e){Kebab.helper.log(application.className+" not loaded...","ERR")}});Kebab.helper.log("Kebab applications loaded...");return applicationInstances},initApplications:function(){var c=this.applications;for(var b=0,a=c.length;b<a;b++){var d=c[b];var e=Ext.apply(d.launcher,d.title);this.windowList.addLauncherMenuItem(e,d.type);d.app=this;if(d.launcher.autoStart){d.createApplication()}}},getApplication:function(d){var c=this.applications;for(var b=0,a=c.length;b<a;b++){if(c[b].id==d||c[b].appType==d){return c[b]}}return null},getApplications:function(){return this.applications},callApplication:function(d,a,b){var c=this.getApplication(d);if(c){a.call(b,c)}},getUser:function(){return this.user},getAssets:function(){return this.assets},getSettings:function(){return this.settings},getDesktop:function(){return this.desktop},onReady:function(b,a){if(!this.isBooted){this.on("booted",b,a)}else{b.call(a,this)}},onUnload:function(a){if(this.fireEvent("beforeunload",this)===false){a.stopEvent()}}});Ext.namespace("Kebab.OS.Desktop");Kebab.OS.Desktop=Ext.extend(Ext.util.Observable,{kernel:null,activeApplicationWindow:null,applicationWindowManager:new Ext.WindowGroup(),contextMenu:null,constructor:function(a){this.kernel=a;this.windowList=new Kebab.OS.Panel.WindowList(a);this.el=Ext.getBody().createChild({tag:"div",cls:"x-desktop"});this.xTickSize=this.yTickSize=1;this.kebabOsPanel=Ext.get("kebab-os-panel");this.kebabOsDesktop=Ext.get("kebab-os-desktop");this.kebabOsDesktopShortcuts=Ext.get("kebab-os-desktop-shortcuts");this.applicationWindowManager.zseed=7000;this.contextMenu=new Ext.menu.Menu({items:[{text:Kebab.helper.translate("Close All"),iconCls:"icon-application-delete",handler:this.closeApplications,scope:this},{text:Kebab.helper.translate("Hide All"),iconCls:"icon-application-put",handler:this.minimizeApplications,scope:this},"-",{text:Kebab.helper.translate("Tile Applications"),iconCls:"icon-application-tile-horizontal",handler:this.tileApplications,scope:this},{text:Kebab.helper.translate("Cascade Applications"),iconCls:"icon-application-cascade",handler:this.cascadeApplications,scope:this},"-",{text:Kebab.helper.translate("Appearance"),iconCls:"icon-palette",scope:this}]});Kebab.OS.Desktop.superclass.constructor.call(this);this.initEvents();this.layout()},initEvents:function(){Ext.EventManager.onWindowResize(this.layout,this);this.kebabOsDesktop.on("contextmenu",function(a){if(a.target.id===this.kebabOsDesktop.id){a.stopEvent();if(!this.contextMenu.el){this.contextMenu.render()}this.contextMenu.showAt(a.getXY())}},this);if(this.kebabOsDesktopShortcuts){this.kebabOsDesktopShortcuts.on("click",function(c,b){b=c.getTarget("dt",this.kebabOsDesktopShortcuts);if(b){c.stopEvent();var a=this.kernel.getApplication(b.id.replace("-shortcut",""));if(a){a.createApplication()}}},this)}},layout:function(){this.kebabOsDesktop.setHeight(Ext.lib.Dom.getViewHeight()-this.kebabOsPanel.getHeight())},createApplication:function(c,a){var b=new (a||Ext.Window)(Ext.applyIf(c||{},{renderTo:this.kebabOsDesktop,manager:this.applicationWindowManager,minimizable:true,maximizable:true,collapsible:true,constrainHeader:true,shim:false,layout:"fit",animShowCfg:{duration:0,easing:"backOut"},animHideCfg:{duration:0.15,easing:"easeIn"},tools:[{id:"gear",qtip:Kebab.helper.translate("Send feedback this application"),handler:function(f,e,d){this.launchApplication("feedback-application")},scope:this}]}));b.dd.xTickSize=this.xTickSize;b.dd.yTickSize=this.yTickSize;if(b.resizer){b.resizer.widthIncrement=this.xTickSize;b.resizer.heightIncrement=this.yTickSize}b.render(this.kebabOsDesktop);b.taskButton=this.windowList.addTaskButton(b);b.cmenu=new Ext.menu.Menu({items:[]});b.animateTarget=b.taskButton.el;b.on({activate:{fn:this.markActive,scope:this},beforeshow:{fn:this.markActive,scope:this},deactivate:{fn:this.markInactive,scope:this},minimize:{fn:this.minimizeApplication,scope:this},close:{fn:this.removeApplication,scope:this}});this.layout();Kebab.helper.message(b.title,"Initialized...");return b},getManager:function(){return this.applicationWindowManager},getApplication:function(a){return this.applicationWindowManager.get(a)},launchApplication:function(a){this.kernel.callApplication(a,function(b){if(b){b.createApplication()}},this)},getWinWidth:function(){var a=Ext.lib.Dom.getViewWidth();return a<200?200:a},getWinHeight:function(){var a=(Ext.lib.Dom.getViewHeight()-this.kebabOsPanel.getHeight());return a<100?100:a},getWinX:function(a){return(Ext.lib.Dom.getViewWidth()-a)/2},getWinY:function(a){return(Ext.lib.Dom.getViewHeight()-this.kebabOsPanel.getHeight()-a)/2},setTickSize:function(a,b){this.xTickSize=a;if(arguments.length==1){this.yTickSize=a}else{this.yTickSize=b}this.applicationWindowManager.each(function(c){c.dd.xTickSize=this.xTickSize;c.dd.yTickSize=this.yTickSize;c.resizer.widthIncrement=this.xTickSize;c.resizer.heightIncrement=this.yTickSize},this)},minimizeApplication:function(a){a.minimized=true;a.hide()},markActive:function(a){if(this.activeApplicationWindow&&this.activeApplicationWindow!=a){this.markInactive(this.activeApplicationWindow)}this.windowList.setActiveButton(a.taskButton);this.activeApplicationWindow=a;Ext.fly(a.taskButton.el).addClass("active-application-window");a.minimized=false},markInactive:function(a){if(a==this.activeApplicationWindow){this.activeApplicationWindow=null;Ext.fly(a.taskButton.el).removeClass("active-application-window")}},removeApplication:function(a){this.windowList.removeTaskButton(a.taskButton);this.layout()},closeApplications:function(){this.applicationWindowManager.each(function(a){a.close()},this)},minimizeApplications:function(){this.applicationWindowManager.each(function(a){this.minimizeApplication(a)},this)},cascadeApplications:function(){var a=0,b=0;this.applicationWindowManager.each(function(c){if(c.isVisible()&&!c.maximized){c.setPosition(a,b);a+=20;b+=20}},this)},tileApplications:function(){var d=this.kebabOsDesktop.getWidth(true);var a=this.xTickSize;var c=this.yTickSize;var b=c;this.applicationWindowManager.each(function(f){if(f.isVisible()&&!f.maximized){var e=f.el.getWidth();if((a>this.xTickSize)&&(a+e>d)){a=this.xTickSize;c=b}f.setPosition(a,c);a+=e+this.xTickSize;b=Math.max(b,c+f.el.getHeight()+this.yTickSize)}},this)},setBackgroundColor:function(a){if(a){Ext.get(document.body).setStyle("background-color","#"+a)}},setFontColor:function(a){if(a){Ext.util.CSS.updateRule(".ux-shortcut-btn-text","color","#"+a)}}});Ext.namespace("Kebab.OS.Application");Kebab.OS.Application=function(){this.translations=null;this.launcher=Ext.applyIf(this.launcher,{text:"Default Application",iconCls:"default-application-launcher-icon",handler:this.createApplication,scope:this});this.init();this.initResources();this.initTranslations();Kebab.OS.Application.superclass.constructor.call(this);Kebab.helper.log(this.id+" application initialized...")};Ext.extend(Kebab.OS.Application,Ext.util.Observable,{init:Ext.emptyFn,createApplication:Ext.emptyFn,initResources:function(){try{this.resources={getTranslator:function(){return Kebab.getOS().getTranslator()},getLogger:function(){return Kebab.getOS().getLogger()},getNotification:function(){return Kebab.getOS().getNotification()}}}catch(a){Kebab.getOS().getLogger().log(this.id+" resources not loaded...","ERR")}},initTranslations:function(){var appName=this.id.replace("-application","").trim();var _replaceNameSpace=function(){return"KebabOS.applications.APP_NAME.application.languages".replace("APP_NAME",appName).trim()};var translations=eval(_replaceNameSpace());this.getResources().getTranslator().addTranslations(translations[this.getResources().getTranslator().getLocale()]);this.setTranslations(translations)},setTranslations:function(a){this.translations=a},getTranslations:function(a){return a?this.translations[this.getResources().getTranslator().getLocale()]:this.translations},getResources:function(){return this.resources}});Ext.namespace("Kebab.OS.Panel");Kebab.OS.Panel.WindowList=function(a){this.kernel=a;this.init()};Ext.extend(Kebab.OS.Panel.WindowList,Ext.util.Observable,{user:null,mainMenu:null,mainMenuComponent:null,applicationsMenu:null,indicatorsAreaComponent:null,systemMenu:null,buttonTpl:new Ext.Template('<table cellspacing="0" class="x-btn"><tbody class="{1}"><tr>','<td><em class="{2}">','<button class="x-btn-text" type="{0}" style="height:30px;"></button>',"</em></td>","</tr></tbody></table>"),init:function(){this.user=this.kernel.getUser();new Kebab.OS.Panel.Container({el:"kebab-os-panel",layout:"border",items:[this.buildMainMenuArea(),this.buildWindowListArea(),this.buildIndicatorsArea()]});return this},buildMainMenuArea:function(){this.applicationsMenu={text:Kebab.helper.translate("Applications"),id:"kebab-os-panel-main-menu-applications",iconCls:"icon-kebab-os",template:new Ext.Template('<table cellspacing="0" class="x-btn"><tbody class="{1}"><tr>','<td><em class="{2}">','<button id="kebab-os-panel-main-menu-applications-button" class="x-btn-text" type="{0}" style="height:30px;"></button>',"</em></td>","</tr></tbody></table>"),menu:new Ext.menu.Menu()};this.systemMenu={text:Kebab.helper.translate("System"),id:"kebab-os-panel-main-menu-system",template:this.buttonTpl,menuWidth:200,menu:new Ext.menu.Menu()};this.mainMenu=new Ext.Toolbar({renderTo:"kebab-os-panel-main-menu",items:[this.applicationsMenu,this.systemMenu]});return this.mainMenuComponent=new Ext.BoxComponent({el:"kebab-os-panel-main-menu",region:"west",width:185,minSize:185,maxSize:185,split:true})},buildWindowListArea:function(){return this.windowList=new Kebab.OS.Panel.WindowList.Buttons({el:"kebab-os-panel-window-list",region:"center"})},buildIndicatorsArea:function(){var b=[new Kebab.OS.Indicators.QuickStart({kernel:this.kernel}),new Kebab.OS.Indicators.Connection({kernel:this.kernel}),new Kebab.OS.Indicators.Language({kernel:this.kernel}),new Kebab.OS.Indicators.SystemTime({kernel:this.kernel}),new Kebab.OS.Indicators.User({kernel:this.kernel,user:this.user}),new Kebab.OS.Indicators.Session({kernel:this.kernel,user:this.user})];this.indicatorsToolbar=new Ext.Toolbar({renderTo:"kebab-os-panel-indicators",items:b});var a=5;this.indicatorsToolbar.items.each(function(c){a+=c.getWidth()});return this.indicatorsAreaComponent=new Ext.BoxComponent({el:"kebab-os-panel-indicators",width:a,minWidth:a,region:"east",split:true})},addLauncherMenuItem:function(a,c){var b=(c=="application")?this.applicationsMenu:this.systemMenu;b.menu.add(a)},addTaskButton:function(a){return this.windowList.addButton(a,"kebab-os-panel-window-list")},removeTaskButton:function(a){this.windowList.removeButton(a)},setActiveButton:function(a){this.windowList.setActiveButton(a)}});Kebab.OS.Panel.Container=Ext.extend(Ext.Container,{initComponent:function(){Kebab.OS.Panel.Container.superclass.initComponent.call(this);this.el=Ext.get(this.el)||Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.setStyle({overflow:"hidden",margin:"0",border:"0 none"});this.el.dom.scroll="no";this.allowDomMove=false;this.autoWidth=true;this.autoHeight=true;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el},fireResize:function(a,b){this.onResize(a,b,a,b);this.fireEvent("resize",this,a,b,a,b)}});Kebab.OS.Panel.WindowList.Buttons=Ext.extend(Ext.BoxComponent,{activeButton:null,enableScroll:true,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:false,resizeButtons:true,buttonWidth:40,minButtonWidth:40,buttonMargin:2,buttonWidthSet:false,initComponent:function(){this.on("resize",this.delegateUpdates);this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:"ux-taskbuttons-strip-wrap",cn:{tag:"ul",cls:"ux-taskbuttons-strip"}});this.stripSpacer=Ext.get(this.el).createChild({cls:"ux-taskbuttons-strip-spacer"});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:"li",cls:"ux-taskbuttons-edge"});this.strip.createChild({cls:"x-clear"});Kebab.OS.Panel.WindowList.Buttons.superclass.initComponent.call(this)},addButton:function(c){var a=this.strip.createChild({tag:"li"},this.edge);var b=new Kebab.OS.Panel.WindowList.TaskButton(c,a);this.items.push(b);if(!this.buttonWidthSet){this.lastButtonWidth=b.container.getWidth()}this.setActiveButton(b);return b},removeButton:function(d){var b=document.getElementById(d.container.id);d.destroy();b.parentNode.removeChild(b);var e=[];for(var c=0,a=this.items.length;c<a;c++){if(this.items[c]!=d){e.push(this.items[c])}}this.items=e;this.delegateUpdates()},setActiveButton:function(a){this.activeButton=a;this.delegateUpdates()},delegateUpdates:function(){if(this.resizeButtons&&this.rendered){this.autoSize()}if(this.enableScroll&&this.rendered){this.autoScroll()}},autoSize:function(){var h=this.items.length;var c=this.el.dom.offsetWidth;var a=this.el.dom.clientWidth;if(!this.resizeButtons||h<1||!a){return}var k=Math.max(Math.min(Math.floor((a-4)/h)-this.buttonMargin,this.buttonWidth),this.minButtonWidth);var e=this.stripWrap.dom.getElementsByTagName("button");this.lastButtonWidth=Ext.get(e[0].id).findParent("li").offsetWidth;for(var f=0,j=e.length;f<j;f++){var b=e[f];var g=Ext.get(e[f].id).findParent("li").offsetWidth;var d=b.offsetWidth;b.style.width=(k-(g-d))+"px"}},autoScroll:function(){var f=this.items.length;var d=this.el.dom.offsetWidth;var c=this.el.dom.clientWidth;var e=this.stripWrap;var b=e.dom.offsetWidth;var g=this.getScrollPos();var a=this.edge.getOffsetsTo(this.stripWrap)[0]+g;if(!this.enableScroll||f<1||b<20){return}e.setWidth(c);if(a<=c){e.dom.scrollLeft=0;if(this.scrolling){this.scrolling=false;this.el.removeClass("x-taskbuttons-scrolling");this.scrollLeft.hide();this.scrollRight.hide()}}else{if(!this.scrolling){this.el.addClass("x-taskbuttons-scrolling")}c-=e.getMargins("lr");e.setWidth(c>20?c:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers()}else{this.scrollLeft.show();this.scrollRight.show()}}this.scrolling=true;if(g>(a-c)){e.dom.scrollLeft=a-c}else{this.scrollToButton(this.activeButton,true)}this.updateScrollButtons()}},createScrollers:function(){var c=this.el.dom.offsetHeight;var a=this.el.insertFirst({cls:"ux-taskbuttons-scroller-left"});a.setHeight(c);a.addClassOnOver("ux-taskbuttons-scroller-left-over");this.leftRepeater=new Ext.util.ClickRepeater(a,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=a;var b=this.el.insertFirst({cls:"ux-taskbuttons-scroller-right"});b.setHeight(c);b.addClassOnOver("ux-taskbuttons-scroller-right-over");this.rightRepeater=new Ext.util.ClickRepeater(b,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=b},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},getScrollIncrement:function(){return(this.scrollIncrement||this.lastButtonWidth+2)},scrollToButton:function(e,a){e=e.el.dom.parentNode;if(!e){return}var c=e;var g=this.getScrollPos(),d=this.getScrollArea();var f=Ext.fly(c).getOffsetsTo(this.stripWrap)[0]+g;var b=f+c.offsetWidth;if(f<g){this.scrollTo(f,a)}else{if(b>(g+d)){this.scrollTo(b-d,a)}}},scrollTo:function(b,a){this.stripWrap.scrollTo("left",b,a?this.getScrollAnim():false);if(!a){this.updateScrollButtons()}},onScrollRight:function(){var a=this.getScrollWidth()-this.getScrollArea();var c=this.getScrollPos();var b=Math.min(a,c+this.getScrollIncrement());if(b!=c){this.scrollTo(b,this.animScroll)}},onScrollLeft:function(){var b=this.getScrollPos();var a=Math.max(0,b-this.getScrollIncrement());if(a!=b){this.scrollTo(a,this.animScroll)}},updateScrollButtons:function(){var a=this.getScrollPos();this.scrollLeft[a==0?"addClass":"removeClass"]("ux-taskbuttons-scroller-left-disabled");this.scrollRight[a>=(this.getScrollWidth()-this.getScrollArea())?"addClass":"removeClass"]("ux-taskbuttons-scroller-right-disabled")}});Kebab.OS.Panel.WindowList.TaskButton=function(b,a){this.win=b;Kebab.OS.Panel.WindowList.TaskButton.superclass.constructor.call(this,{iconCls:b.iconCls,tooltip:"<strong>"+b.title+"</strong><br/>"+b.description,renderTo:a,handler:function(){if(b.minimized||b.hidden){b.show()}else{if(b==b.manager.getActive()){b.minimize()}else{b.toFront()}}},clickEvent:"mousedown",template:new Ext.Template('<table cellspacing="0" class="x-btn {3}"><tbody><tr>','<td class="ux-taskbutton-left"><em>&#160;</em></td>','<td class="ux-taskbutton-center"><em class="{5} unselectable="on">','<button class="x-btn-text {2}" type="{1}" style="height:28px;">{0}</button>',"</em></td>",'<td class="ux-taskbutton-right"><em>&#160;</em></td>',"</tr></tbody></table>")})};Ext.extend(Kebab.OS.Panel.WindowList.TaskButton,Ext.Button,{onRender:function(){Kebab.OS.Panel.WindowList.TaskButton.superclass.onRender.apply(this,arguments);this.cmenu=new Ext.menu.Menu({items:[{text:Kebab.helper.translate("Restore"),iconCls:"icon-arrow-inout",handler:function(){if(!this.win.isVisible()){this.win.show()}else{this.win.restore()}},scope:this},{text:Kebab.helper.translate("Minimize"),iconCls:"icon-arrow-in",handler:this.win.minimize,scope:this.win},{text:Kebab.helper.translate("Maximize"),iconCls:"icon-arrow-out",handler:this.win.maximize,scope:this.win},"-",{text:Kebab.helper.translate("Close"),iconCls:"icon-cancel",handler:this.closeWin.createDelegate(this,this.win,true),scope:this.win}]});this.cmenu.on("beforeshow",function(){var b=this.cmenu.items.items;var a=this.win;b[0].setDisabled(a.maximized!==true&&a.hidden!==true);b[1].setDisabled(a.minimized===true);b[2].setDisabled(a.maximized===true||a.hidden===true)},this);this.el.on("contextmenu",function(b){b.stopEvent();if(!this.cmenu.el){this.cmenu.render()}var a=b.getXY();a[1]-=this.cmenu.el.getHeight()-110;this.cmenu.showAt(a)},this)},closeWin:function(a,c,b){if(!b.isVisible()){b.show()}else{b.restore()}b.close()}});Ext.namespace("Kebab.OS.Indicator");Kebab.OS.Indicator=Ext.extend(Ext.Button,{kernel:null,tpl:new Ext.Template('<table cellspacing="0" class="x-btn"><tbody class="{1}"><tr>','<td><em class="{2}">','<button class="x-btn-text" type="{0}" style="height:30px;"></button>',"</em></td>","</tr></tbody></table>"),initComponent:function(){var a={template:this.tpl};Ext.apply(this,a);Kebab.OS.Indicator.superclass.initComponent.call(this)}});Ext.namespace("Kebab.OS.Indicator.Window");Kebab.OS.Indicator.Window=Ext.extend(Ext.Window,{indicator:null,initComponent:function(){var a={shim:false,layout:"fit",collapsible:true,animShowCfg:{duration:0,easing:"backOut"},animHideCfg:{duration:0.15,easing:"easeIn"},renderTo:this.indicator.kernel.getDesktop().kebabOsDesktop,manager:this.indicator.kernel.getDesktop().getManager(),x:this.indicator.el.getX()-this.width,y:50,constrainHeader:true,animateTarget:this.indicator.el,closeAction:"hide",buttons:[{text:Kebab.helper.translate("Close"),iconCls:"icon-cancel",handler:function(){this.hide()},scope:this}]};Ext.apply(this,a);Kebab.OS.Indicator.Window.superclass.initComponent.call(this)}});